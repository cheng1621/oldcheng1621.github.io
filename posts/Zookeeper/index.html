<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="ZooKeeper Note" /><meta property="og:locale" content="en" /><meta name="description" content="Abstract Zookeeper: high performance instead of wait-free property. FIFO requests and linearizability for all requests." /><meta property="og:description" content="Abstract Zookeeper: high performance instead of wait-free property. FIFO requests and linearizability for all requests." /><link rel="canonical" href="https://cheng1621.github.io//posts/Zookeeper/" /><meta property="og:url" content="https://cheng1621.github.io//posts/Zookeeper/" /><meta property="og:site_name" content="HelloBen" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-02T23:17:10+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ZooKeeper Note" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheng1621.github.io//posts/Zookeeper/"},"description":"Abstract Zookeeper: high performance instead of wait-free property. FIFO requests and linearizability for all requests.","url":"https://cheng1621.github.io//posts/Zookeeper/","@type":"BlogPosting","headline":"ZooKeeper Note","dateModified":"2021-01-02T23:17:10+08:00","datePublished":"2021-01-02T23:17:10+08:00","@context":"https://schema.org"}</script><title>ZooKeeper Note | HelloBen</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="HelloBen"><meta name="application-name" content="HelloBen"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/android-chrome-192x192.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">HelloBen</a></div><div class="site-subtitle font-italic">Keeping Trying</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/cheng1621" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['subencheng','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ZooKeeper Note</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>ZooKeeper Note</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> BenchengSu </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jan 2, 2021, 11:17 PM +0800" >Jan 2, 2021<i class="unloaded">2021-01-02T23:17:10+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="624 words">3 min read</span></div></div><div class="post-content"><h1 id="abstract">Abstract</h1><p>Zookeeper: high performance instead of wait-free property. FIFO requests and linearizability for all requests.</p><h1 id="introduction">Introduction.</h1><p>Instead of implementing the server side, Zookeeper opted to implement application side. That implementation of coordination kernel enables primitive without requesting change to core service. In Zookeeper, blockint primitive are moved away because wait-free property is really important for fault-torelance and high performance. Method: <strong><em>FIFO</em></strong> client ordering, <strong><em>linearization</em></strong>.</p><h1 id="zookeeper-service">Zookeeper Service.</h1><h2 id="service-overview">Service Overview</h2><p><code class="language-plaintext highlighter-rouge">sequential flag</code>: monotonically increasing counter. <br /> <code class="language-plaintext highlighter-rouge">Watches</code>: one-time triggers associated with a session, used to tell the client that the value is changed even though the value is returned.<br /> <code class="language-plaintext highlighter-rouge">Data Model</code>: Not designed for general data storage. Instead, it map to the abstraction of the tree, (metadata)<br /> <code class="language-plaintext highlighter-rouge">metadata</code>: configuration info, shared data storage location, version of znode.<br /> <code class="language-plaintext highlighter-rouge">Session</code>: Initialized when client connects to Zookeeper. <strong><em>Timeout</em></strong> is provided and state changes are observed within the session. <strong><em>znode</em></strong> is organized in hierarchical name space tree.<br /> client can create two znode: <strong><em>Regular</em></strong> and <strong><em>Ephemeral</em></strong>.</p><h2 id="client-api">Client API</h2><p><code class="language-plaintext highlighter-rouge">create(path,data,flags)</code>: create a znode.<br /> <code class="language-plaintext highlighter-rouge">delete(path,version)</code> : delete a znode at expected version.<br /> <code class="language-plaintext highlighter-rouge">exists(path, watch)</code> : return true if znode is existed.<br /> <code class="language-plaintext highlighter-rouge">getData(path, watch)</code> : Return data.<br /> <code class="language-plaintext highlighter-rouge">setData(path, data, version)</code> : write something to znode.<br /> <code class="language-plaintext highlighter-rouge">getChildren(path, watch)</code> : return name of the set and children of a node.<br /> <code class="language-plaintext highlighter-rouge">sync(path)</code> : waits for all updates pending at the start to propagate to the server.<br /> Zookeeper has <strong><em>synchronous</em></strong> and <strong><em>asynchronous</em></strong> version. Failure happens if the version is not matched.<br /> all API has a parameter named path, which means that zookeeper access znode through path. In that case, some API like <strong><em>open</em></strong> and <strong><em>close</em></strong> could be simplified and some extra data can be eliminated.</p><h2 id="zookeeper-guarantees">Zookeeper guarantees.</h2><p>two guarantees: <code class="language-plaintext highlighter-rouge">Linearizable writes</code> and <code class="language-plaintext highlighter-rouge">FIFO client order</code>..<br /> two main points : 1. other processes cannot use configuration if one process make a change to it. 2. a process can only use whole process instead of partial process.<br /> one problem can be further discussed: what if a process read a <strong><em>ready</em></strong> node and start reading and at the same time a leader make a change to it. (ordering guarantee for notifications.)</p><h2 id="examples-of-primitives">Examples of primitives.</h2><p>the paper lists some of primitives, such as <strong><em>Configuration Management</em></strong>, <strong><em>Rendezvous</em></strong>, <strong><em>Group Membership</em></strong>, <strong><em>Locks</em></strong>. all these primitives show one key thought, <strong><em>a process can create a new ephemeral znode with some metadata</em></strong>.</p><p><code class="language-plaintext highlighter-rouge">simple locks</code>: many clients would compete for the locks with herd effect.<br /> <code class="language-plaintext highlighter-rouge">Locks without herd effect</code> : all the requests are lined up. <br /> <code class="language-plaintext highlighter-rouge">Double Barrier</code> : synchronize the beginning and the end of computation.</p><h1 id="zookeeper-applications">Zookeeper Applications.</h1><h2 id="fetching-service">Fetching Service</h2><p>Zookeeper is used to manage the <strong><em>configuration metadata</em></strong>. When decoupling clients from servers, it guarantee the requests go to healthy service.</p><h2 id="katta">Katta</h2><p>Divide the work of indexing using shards.</p><h2 id="yahoo-message-broker">Yahoo! Message Broker.</h2><p>manage three parts: <code class="language-plaintext highlighter-rouge">configuration metadata</code>, <code class="language-plaintext highlighter-rouge">failure detection</code> and <code class="language-plaintext highlighter-rouge">group membership</code>.</p><h1 id="zookeeper-implementation">Zookeeper implementation.</h1><p><code class="language-plaintext highlighter-rouge">read</code> requests: serviced from local replica of server database.<br /> <code class="language-plaintext highlighter-rouge">write</code> requests: serviced from agreement protocol. (leader broadcasts to followers and replicate.)</p><h2 id="request-processor">Request Processor</h2><p>future state, version must be calculated when applying something to state machine to guarantee consensus. If successful <code class="language-plaintext highlighter-rouge">TXN</code> should be returned and otherwise, <code class="language-plaintext highlighter-rouge">errorTXN</code> is returned.</p><h2 id="atomic-broadcast">Atomic Broadcast.</h2><p>changes to Zookeeper are throught <strong><em>Zab</em></strong>. To keep high throughput, Zookeeer keep processing pipeline full and guarantee the changes are in the order the clients sent.<br /> Normally, Zab delivered all the messages once, but it does not know whether the message is delivered successfully or not.</p><h2 id="replicated-database">Replicated Database</h2><p>Snapshot is required in case of recovery.</p><h2 id="client-server-interactions">Client-Server Interactions</h2><p>note:</p><ol><li>when one write is processing, no other write and read are executing concurrently.<li>when one read operation is returned, a tagged parameter named zxid corresponding to last transaction is returned.<li>a stale value maybe returned if using fast reads. Solved by <code class="language-plaintext highlighter-rouge">sync</code>.<li>timeout.</ol><p><strong><em>(at this time, I care less about the performance of the Zookeeper.)</em></strong></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/distributed-system/'>Distributed System</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/distributed-system/" class="post-tag no-text-decoration" >Distributed System</a> <a href="/tags/zookeeper/" class="post-tag no-text-decoration" >Zookeeper</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ZooKeeper Note - HelloBen&url=https://cheng1621.github.io//posts/Zookeeper/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ZooKeeper Note - HelloBen&u=https://cheng1621.github.io//posts/Zookeeper/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=ZooKeeper Note - HelloBen&url=https://cheng1621.github.io//posts/Zookeeper/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/amazon_leadership/">Amazon bq question</a><li><a href="/posts/OOD_Design/">Design Parking Lot</a><li><a href="/posts/fault-tolerant-system/">6.824 (假设能拿到offer的项目）</a><li><a href="/posts/lowLatency_MultiDatacenter_Databases_Using_Replicated_Commit/">Low-Latency Multi-Datacenter Databases using Replicated Commit Note</a><li><a href="/posts/Frangipani/">frangipani</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/distributed-system/">Distributed System</a> <a class="post-tag" href="/tags/raft/">Raft</a> <a class="post-tag" href="/tags/large-scale-software-engineering/">Large Scale Software Engineering</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/amazon/">Amazon</a> <a class="post-tag" href="/tags/aurora/">Aurora</a> <a class="post-tag" href="/tags/craq/">CRAQ</a> <a class="post-tag" href="/tags/frangipani/">frangipani</a> <a class="post-tag" href="/tags/gfs/">gfs</a> <a class="post-tag" href="/tags/kvservice/">kvservice</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/fault-tolerant-system/"><div class="card-body"> <span class="timeago small" >Jun 1, 2021<i class="unloaded">2021-06-01T19:10:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824 (假设能拿到offer的项目）</h3><div class="text-muted small"><p> 1.先来个自我介绍吧。 嗯嗯，我之前写过一个基于LLVM的小型编译器，写过一个小型操作系统的kernel，最近写过一个有关分布式系统的，这个分布式系统实际上就是一个可容错性的分布式key/value数据库，支持动态扩容，负载均衡，线性一致性，这个一致性是基于raft共识算法，嗯，raft 就是为了在不同的服务器保持一致性的一种算法。这个数据库支持一定的容错，就是一个服务器崩了，另一个服务器马...</p></div></div></a></div><div class="card"> <a href="/posts/gfsNote/"><div class="card-body"> <span class="timeago small" >Jun 26, 2021<i class="unloaded">2021-06-26T08:10:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>gfs Note</h3><div class="text-muted small"><p> why. component failure is norm rather than exception. files are huge by traditional standards. design overview. suppose the component often fail. make optimation for multi-GB files. for ran...</p></div></div></a></div><div class="card"> <a href="/posts/firstPost/"><div class="card-body"> <span class="timeago small" >Nov 24, 2020<i class="unloaded">2020-11-24T16:29:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824 Lab1 MapReduce</h3><div class="text-muted small"><p> Preparation MapReduce Paper Lab1 Summary Lab1 is to implement a Worker process and a Master process. Whole process: go build -buildmode=plugin ../mrapps/wc.go first build word-count plug...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/computerNetworkNote/" class="btn btn-outline-primary" prompt="Older"><p>Computernetworknote</p></a> <a href="/posts/CRAQ/" class="btn btn-outline-primary" prompt="Newer"><p>CRAQ Note</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">BenchengSu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/distributed-system/">Distributed System</a> <a class="post-tag" href="/tags/raft/">Raft</a> <a class="post-tag" href="/tags/large-scale-software-engineering/">Large Scale Software Engineering</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/amazon/">Amazon</a> <a class="post-tag" href="/tags/aurora/">Aurora</a> <a class="post-tag" href="/tags/craq/">CRAQ</a> <a class="post-tag" href="/tags/frangipani/">frangipani</a> <a class="post-tag" href="/tags/gfs/">gfs</a> <a class="post-tag" href="/tags/kvservice/">kvservice</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
