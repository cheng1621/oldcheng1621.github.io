<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="gfs Note" /><meta property="og:locale" content="en" /><meta name="description" content="why. component failure is norm rather than exception. files are huge by traditional standards." /><meta property="og:description" content="why. component failure is norm rather than exception. files are huge by traditional standards." /><link rel="canonical" href="https://cheng1621.github.io//posts/gfsNote/" /><meta property="og:url" content="https://cheng1621.github.io//posts/gfsNote/" /><meta property="og:site_name" content="HelloBen" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-26T08:10:10+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="gfs Note" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheng1621.github.io//posts/gfsNote/"},"description":"why. component failure is norm rather than exception. files are huge by traditional standards.","url":"https://cheng1621.github.io//posts/gfsNote/","@type":"BlogPosting","headline":"gfs Note","dateModified":"2021-06-26T08:10:10+08:00","datePublished":"2021-06-26T08:10:10+08:00","@context":"https://schema.org"}</script><title>gfs Note | HelloBen</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="HelloBen"><meta name="application-name" content="HelloBen"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/android-chrome-192x192.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">HelloBen</a></div><div class="site-subtitle font-italic">Keeping Trying</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/cheng1621" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['subencheng','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>gfs Note</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>gfs Note</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> BenchengSu </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jun 26, 2021, 8:10 AM +0800" >Jun 26, 2021<i class="unloaded">2021-06-26T08:10:10+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="512 words">2 min read</span></div></div><div class="post-content"><h1 id="why">why.</h1><p>component failure is norm rather than exception.<br /> files are huge by traditional standards.</p><h1 id="design-overview">design overview.</h1><ul><li>suppose the component often fail.<li>make optimation for multi-GB files.<li>for random reads, batch and sort them to advance steadily through files rather than go back and forth.<li>concurrent appendance by multiple clients to a same file is also supported.</ul><h1 id="architecture">architecture.</h1><p>a <code class="language-plaintext highlighter-rouge">master</code> and several <code class="language-plaintext highlighter-rouge">chunkservers</code>.<br /> master maintains all the system metadata, including namespace,location … etc.<br /> neither the client nor the chunkserver caches file data, since the file maybe too large to be cached.</p><h2 id="single-master">Single master.</h2><p>process: client send packets consists of the <code class="language-plaintext highlighter-rouge">file name</code> and <code class="language-plaintext highlighter-rouge">chunk index</code> and the server responds with the locations of the chunk. Then client to one of the replicas for the data. <code class="language-plaintext highlighter-rouge">no more client-master interactions are needed until the information expired</code>.</p><h2 id="chunk-size">Chunk Size.</h2><p>usually 64 MB. advantages:</p><ul><li>reduce client-master interaction. Read and writes on the same file need one interaction.<li>a client is more likely to perform many operations on the same files, it could reduce the network overhead.<li>reduce the metadata which is stored in master.</ul><h2 id="metadata">Metadata.</h2><p>three metadata: <code class="language-plaintext highlighter-rouge">file namespace and chunk namespace</code>, <code class="language-plaintext highlighter-rouge">mapping file to chunk</code> and <code class="language-plaintext highlighter-rouge">locations of chunk's replicas.</code></p><h3 id="in-memory-data-structure">In-memory Data Structure.</h3><p>advantages: easy to scan through master’s state and implement the chunk garbage collection.</p><h3 id="chunk-location">chunk location.</h3><ul><li>easy to request the data at startup.<li>if the chunk is moved or failed, there is no point to maintain all the information.</ul><h3 id="operation-log">Operation Log.</h3><p>replicate operation log on mutiple remote machines and respond to a client operation after flushing the OL to disk both locally and remotely.</p><h2 id="consistency-model">Consistency Model.</h2><h3 id="guarantee-by-gfs">guarantee by GFS.</h3><p>some terminology: <code class="language-plaintext highlighter-rouge">defined</code>, <code class="language-plaintext highlighter-rouge">consistent</code>.<br /> GFS identifies failed chunkserver by checksumming.</p><h3 id="implication-for-applications">implication for applications.</h3><p>application mutates file by appending rather than overwriting. that means, a writer generates a file from begining to end.</p><h1 id="system-interaction">system interaction.</h1><p>master granted a <code class="language-plaintext highlighter-rouge">lease</code> to one of the replicas, named <code class="language-plaintext highlighter-rouge">primary</code>. primary define a mutation order. Sometimes primary could revoke the lease to disable the mutation on a file.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>1. client send requests to master for metadata of the chunk.  
2. client push data to replicas.
3. after the step 2, client send write request to primary.
4. primary forward write request to secondary replica.
5. secondary replies to primary.
6. primary replies to client.  
</pre></table></code></div></div><h2 id="data-flow">data flow.</h2><p>to avoid network latency, one server send the information to closest server, instead of <code class="language-plaintext highlighter-rouge">tree topology</code>.</p><h2 id="atomic-record-appends">atomic Record appends.</h2><p>GFS only guarantee the data is written at least once as an atomic unit, which means that data could include duplicate records.</p><h2 id="snapshot">snapshot.</h2><p><code class="language-plaintext highlighter-rouge">copy on write</code></p><h1 id="master-operation">master operation.</h1><h2 id="namespace-management-and-locking">namespace management and locking.</h2><p>GFS does not have a per-directory data structure that lists all the files in directory, nor does it support aliases.</p><h2 id="replica-placement">Replica Placement.</h2><h2 id="creation-re-replication-reblancing">Creation, Re-replication, reblancing.</h2><h2 id="garbage-collection">garbage collection.</h2><p>instead of reclaiming the delete object, the file changed to hidden object.</p><h2 id="stale-replica-detection">stale replica detection.</h2><p>chunk version number is needed.</p><h1 id="fault-tolerance-and-diagnosis">fault tolerance and diagnosis.</h1><h2 id="high-availability">high availability</h2><p><code class="language-plaintext highlighter-rouge">fast recovery</code>, <code class="language-plaintext highlighter-rouge">chunk replication</code> and <code class="language-plaintext highlighter-rouge">master replication</code>.<br /> if master is down, <code class="language-plaintext highlighter-rouge">shadow master</code> provides read-only access to the file system.</p><h2 id="data-integrity">data integrity.</h2><p>checksumming.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/distributed-system/'>Distributed System</a>, <a href='/categories/mit-6824/'>MIT 6824</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/distributed-system/" class="post-tag no-text-decoration" >Distributed System</a> <a href="/tags/gfs/" class="post-tag no-text-decoration" >gfs</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=gfs Note - HelloBen&url=https://cheng1621.github.io//posts/gfsNote/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=gfs Note - HelloBen&u=https://cheng1621.github.io//posts/gfsNote/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=gfs Note - HelloBen&url=https://cheng1621.github.io//posts/gfsNote/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/amazon_leadership/">Amazon bq question</a><li><a href="/posts/OOD_Design/">Design Parking Lot</a><li><a href="/posts/fault-tolerant-system/">6.824 (假设能拿到offer的项目）</a><li><a href="/posts/lowLatency_MultiDatacenter_Databases_Using_Replicated_Commit/">Low-Latency Multi-Datacenter Databases using Replicated Commit Note</a><li><a href="/posts/Frangipani/">frangipani</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/distributed-system/">Distributed System</a> <a class="post-tag" href="/tags/raft/">Raft</a> <a class="post-tag" href="/tags/large-scale-software-engineering/">Large Scale Software Engineering</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/amazon/">Amazon</a> <a class="post-tag" href="/tags/aurora/">Aurora</a> <a class="post-tag" href="/tags/craq/">CRAQ</a> <a class="post-tag" href="/tags/frangipani/">frangipani</a> <a class="post-tag" href="/tags/gfs/">gfs</a> <a class="post-tag" href="/tags/kvservice/">kvservice</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/firstPost/"><div class="card-body"> <span class="timeago small" >Nov 24, 2020<i class="unloaded">2020-11-24T16:29:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824 Lab1 MapReduce</h3><div class="text-muted small"><p> Preparation MapReduce Paper Lab1 Summary Lab1 is to implement a Worker process and a Master process. Whole process: go build -buildmode=plugin ../mrapps/wc.go first build word-count plug...</p></div></div></a></div><div class="card"> <a href="/posts/6824_lab3A/"><div class="card-body"> <span class="timeago small" >Jan 15, 2021<i class="unloaded">2021-01-15T09:46:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824 lab3A</h3><div class="text-muted small"><p> Summary Lab3A require us to implement 3 api: put,append and get. we should maintain linearizability. linearizability: if append: a-&gt;13 is executed before get: a, get should return 13. To avoid t...</p></div></div></a></div><div class="card"> <a href="/posts/Aurora/"><div class="card-body"> <span class="timeago small" >Jan 19, 2021<i class="unloaded">2021-01-19T09:46:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Amazon Aurora Note</h3><div class="text-muted small"><p> Abstract. Aurora is a service as part of AWS. The bottleneck of the performance is moving from storage, kind of things to network. It was pushing redo processing to a multi-tenant scale-out storage...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/computer_network_note/" class="btn btn-outline-primary" prompt="Older"><p>Computer Network Note</p></a> <a href="/posts/amazon_leadership/" class="btn btn-outline-primary" prompt="Newer"><p>Amazon bq question</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">BenchengSu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/distributed-system/">Distributed System</a> <a class="post-tag" href="/tags/raft/">Raft</a> <a class="post-tag" href="/tags/large-scale-software-engineering/">Large Scale Software Engineering</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/amazon/">Amazon</a> <a class="post-tag" href="/tags/aurora/">Aurora</a> <a class="post-tag" href="/tags/craq/">CRAQ</a> <a class="post-tag" href="/tags/frangipani/">frangipani</a> <a class="post-tag" href="/tags/gfs/">gfs</a> <a class="post-tag" href="/tags/kvservice/">kvservice</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
